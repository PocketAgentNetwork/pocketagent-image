ðŸ“Ÿ POCKETAGENT LOCAL DEPLOYMENT - Build Plan
==============================================

GOAL: Native installation of PocketAgent on local machines
Works on: Mac, Linux, Windows (native, not Docker)

---

## INSTALLER VERSIONS

### Version 0.x: Shell Script Installer (Current Focus)
- One-line install: `curl -fsSL https://install.pocketagent.com | bash`
- Terminal-based, no GUI
- Installs agent as background service
- User accesses via web browser (localhost:18789)
- Quick to build and test
- For developers and early adopters

### Version 1.x: GUI Installer (Future)
- **Mac**: `.dmg` or `.pkg` with GUI wizard
- **Windows**: `.exe` or `.msi` installer
- **Linux**: `.deb`, `.rpm`, or AppImage
- Double-click to install
- Progress bars, nice UX
- Still installs agent as background service
- User accesses via web browser or separate client app
- For mainstream users

### Version 2.x: Native App Bundle (Future - All-in-One)
- **Installer + Client in one package!**
- Download one app (PocketAgent.dmg / PocketAgent.exe)
- First launch:
  1. Installer runs â†’ Sets up agent as background service
  2. Client UI opens automatically
  3. Client connects to local agent
  4. User sees native interface immediately
- Includes:
  - Agent (background service)
  - Client (native UI for chatting with agent)
  - QR code for mobile pairing
- Like: Slack, Discord (desktop app with built-in backend)
- Best UX - everything just works!

**Current Focus:** v0.x shell script installer

---

## WHAT WE'RE BUILDING

A native PocketAgent installation that:
1. Runs OpenClaw under the hood (hidden)
2. All branding is "PocketAgent" ðŸ“Ÿ
3. Integrates with OS (menu bar, system tray, etc.)
4. Works on Mac, Linux, Windows
5. User never sees "OpenClaw" or technical details

---

## FOLDER STRUCTURE (OS-Specific)

### macOS:
```
/Applications/PocketAgent/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ pocketagent              # Main executable
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ openclaw/                # OpenClaw (hidden)
â”œâ”€â”€ home/                        # Agent's home directory
â”‚   â”œâ”€â”€ .openclaw/              # Config & memory
â”‚   â”œâ”€â”€ files/                  # Workspace
â”‚   â”œâ”€â”€ .local/bin/             # Installed tools
â”‚   â”œâ”€â”€ .ssh/                   # SSH keys
â”‚   â””â”€â”€ .config/                # Other configs
â”œâ”€â”€ data/                        # PocketAgent data
â”‚   â”œâ”€â”€ pocketmodel/            # (future)
â”‚   â””â”€â”€ pan/                    # (future)
â””â”€â”€ logs/                        # Logs
    â”œâ”€â”€ openclaw.log
    â””â”€â”€ pocketagent.log
```

### Linux:
```
~/.local/share/pocketagent/      # Or /opt/pocketagent/ for system-wide
â”œâ”€â”€ bin/
â”œâ”€â”€ lib/
â”œâ”€â”€ home/
â”œâ”€â”€ data/
â””â”€â”€ logs/
```

### Windows:
```
C:\Users\{username}\AppData\Local\PocketAgent\
â”œâ”€â”€ bin\
â”œâ”€â”€ lib\
â”œâ”€â”€ home\
â”œâ”€â”€ data\
â””â”€â”€ logs\
```

---

## COMPONENTS

### 1. OpenClaw (Core Framework)
- Location: `lib/openclaw/`
- Cloned from: https://github.com/openclaw/openclaw
- Built with: pnpm install && pnpm build
- Hidden from user

### 2. PocketAgent Wrapper
- Location: `bin/pocketagent`
- Sets HOME to agent's home directory
- Starts OpenClaw with PocketAgent branding
- Handles startup/shutdown

### 3. Agent Home Directory
- Location: `home/`
- OpenClaw uses this as $HOME
- Contains:
  - `.openclaw/` - Config, memory, credentials
  - `files/` - Workspace
  - `.local/bin/` - Tools
  - `.ssh/` - SSH keys

### 4. Workspace (Baked In)
- Same workspace files as Cloud image
- IDENTITY.md, SOUL.md, JOB.md, etc.
- Copied to `home/.openclaw/workspace/` on first run

---

## INSTALLATION FLOW

### Step 1: Prerequisites Check
- Node.js 22+ installed
- pnpm installed (or install it)
- Git installed

### Step 2: Create Folder Structure
- Create all directories
- Set proper permissions

### Step 3: Install OpenClaw
```bash
cd lib/openclaw
git clone https://github.com/openclaw/openclaw.git .
pnpm install
pnpm build
```

### Step 4: Copy Workspace Files
- Copy workspace/ to home/.openclaw/workspace/
- Set version file

### Step 5: Create Wrapper Script
- bin/pocketagent script
- Sets environment variables
- Starts OpenClaw

### Step 6: Setup System Integration
- macOS: Create launchd plist
- Linux: Create systemd service
- Windows: Create Windows Service

### Step 7: Generate Gateway Token
- Run setup script
- Save to home/.openclaw/.env

---

## STARTUP SEQUENCE

1. User runs: `pocketagent start`
2. Wrapper script sets:
   - HOME=/Applications/PocketAgent/home
   - XDG_CONFIG_HOME=$HOME/.openclaw
3. Starts OpenClaw gateway
4. OpenClaw binds to localhost:18789
5. User opens: http://localhost:18789
6. Onboarding UI appears
7. User configures agent
8. Agent is live!

---

## WRAPPER SCRIPT (bin/pocketagent)

```bash
#!/bin/bash
# PocketAgent Wrapper Script

POCKETAGENT_ROOT="/Applications/PocketAgent"
POCKETAGENT_HOME="$POCKETAGENT_ROOT/home"
OPENCLAW_PATH="$POCKETAGENT_ROOT/lib/openclaw"

export HOME="$POCKETAGENT_HOME"
export XDG_CONFIG_HOME="$HOME/.openclaw"

case "$1" in
  start)
    echo "ðŸ“Ÿ Starting PocketAgent..."
    cd "$OPENCLAW_PATH"
    node dist/index.js gateway \
      --workspace "$HOME/.openclaw/workspace" \
      --bind "127.0.0.1" \
      --port 18789 \
      --allow-unconfigured
    ;;
  stop)
    echo "ðŸ“Ÿ Stopping PocketAgent..."
    pkill -f "openclaw.*gateway"
    ;;
  status)
    pgrep -f "openclaw.*gateway" > /dev/null && echo "Running" || echo "Stopped"
    ;;
  *)
    echo "Usage: pocketagent {start|stop|status}"
    exit 1
    ;;
esac
```

---

## OS-SPECIFIC INTEGRATION

### macOS: launchd Service
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.pocketagent.daemon</string>
    <key>ProgramArguments</key>
    <array>
        <string>/Applications/PocketAgent/bin/pocketagent</string>
        <string>start</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
</dict>
</plist>
```

### Linux: systemd Service
```ini
[Unit]
Description=PocketAgent Daemon
After=network.target

[Service]
Type=simple
ExecStart=/home/user/.local/share/pocketagent/bin/pocketagent start
Restart=always

[Install]
WantedBy=multi-user.target
```

### Windows: Windows Service
- Use NSSM (Non-Sucking Service Manager)
- Or Node.js service wrapper

---

## INSTALLER SCRIPT (install.sh)

```bash
#!/bin/bash
# PocketAgent Local Installer

echo "ðŸ“Ÿ PocketAgent Installer"
echo "======================="

# Detect OS
OS="$(uname -s)"
case "$OS" in
  Darwin)  INSTALL_DIR="/Applications/PocketAgent" ;;
  Linux)   INSTALL_DIR="$HOME/.local/share/pocketagent" ;;
  *)       echo "Unsupported OS"; exit 1 ;;
esac

# Check prerequisites
command -v node >/dev/null || { echo "Node.js 22+ required"; exit 1; }
command -v pnpm >/dev/null || { echo "Installing pnpm..."; npm install -g pnpm; }

# Create directories
mkdir -p "$INSTALL_DIR"/{bin,lib,home,data,logs}
mkdir -p "$INSTALL_DIR/home"/{.openclaw,.local/bin,.ssh,.config,files}

# Clone and build OpenClaw
cd "$INSTALL_DIR/lib"
git clone https://github.com/openclaw/openclaw.git openclaw
cd openclaw
pnpm install
pnpm build

# Copy workspace files
cp -r /path/to/workspace "$INSTALL_DIR/home/.openclaw/workspace"

# Create wrapper script
cat > "$INSTALL_DIR/bin/pocketagent" << 'EOF'
#!/bin/bash
# [wrapper script content here]
EOF
chmod +x "$INSTALL_DIR/bin/pocketagent"

# Generate gateway token
TOKEN=$(openssl rand -hex 32)
echo "OPENCLAW_GATEWAY_TOKEN=$TOKEN" > "$INSTALL_DIR/home/.openclaw/.env"

echo "âœ… PocketAgent installed!"
echo ""
echo "Start with: $INSTALL_DIR/bin/pocketagent start"
echo "Open: http://localhost:18789"
```

---

## DEVELOPMENT STEPS

### Phase 1: Basic Installation âœ… (Next)
1. Create folder structure
2. Install OpenClaw
3. Create wrapper script
4. Test manual start/stop

### Phase 2: Workspace Integration
1. Copy workspace files
2. Version tracking
3. Update mechanism

### Phase 3: System Integration
1. launchd/systemd service
2. Auto-start on boot
3. Menu bar icon (optional)

### Phase 4: Installer
1. One-line installer script
2. Uninstaller
3. Update mechanism

### Phase 5: Docker Alternative (Later)
1. Use same Cloud image
2. Bind to localhost
3. Document as alternative

---

## SUCCESS CRITERIA

âœ… OpenClaw installed and hidden
âœ… Runs as "PocketAgent" service
âœ… Accessible at http://localhost:18789
âœ… Workspace files baked in
âœ… Gateway token generated
âœ… User only sees PocketAgent branding
âœ… Works on Mac and Linux
âœ… Easy to install and uninstall

---

## FUTURE ENHANCEMENTS

### Version 1.x: GUI Installer
- Mac: `.dmg` with drag-to-Applications
- Windows: `.exe` with wizard
- Linux: `.deb`/`.rpm` packages
- Same script logic, wrapped in GUI

### Version 2.x: Additional Features
- PocketModel integration
- PAN Supervisor
- Menu bar/system tray app
- Desktop notifications
- Auto-updates

### Alternative: Docker for Local
- Same Docker image as Cloud
- Bind to localhost instead of 0.0.0.0
- Easy fallback for Docker users

---

**CURRENT FOCUS:** Build the shell script installer (v0.x) for Mac/Linux first!
